<!--ä¸ªäººä¸­å¿ƒé¡µé¢-->
<view class="container">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="login-section" wx:if="{{!isLoggedIn}}">
    <view class="login-card">
      <view class="login-icon">ğŸ‘¤</view>
      <text class="login-title">UAVè€ƒç‚¹ç®¡ç†ç³»ç»Ÿ</text>
      <text class="login-desc">è¯·ä½¿ç”¨èº«ä»½è¯å·ç™»å½•</text>
      <button class="login-btn" bindtap="onWeChatLogin">èº«ä»½è¯ç™»å½•</button>
    </view>
  </view>

  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view class="profile-section" wx:if="{{isLoggedIn}}">
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <view class="user-card">
      <view class="user-avatar">{{userInfo.real_name ? userInfo.real_name.charAt(0) : 'ç”¨'}}</view>
      <view class="user-info">
        <text class="user-name">{{userInfo.real_name || userInfo.username}}</text>
        <text class="user-role">{{userInfo.role === 'candidate' ? 'è€ƒç”Ÿ' : 'è€ƒåŠ¡äººå‘˜'}}</text>
      </view>
      <button class="refresh-btn" bindtap="onRefresh" size="mini">åˆ·æ–°</button>
    </view>

    <!-- è€ƒç”ŸåŠŸèƒ½ -->
    <view class="candidate-section" wx:if="{{userInfo.role === 'candidate'}}">
      <!-- äºŒç»´ç å¡ç‰‡ -->
      <view class="qr-card">
        <view class="qr-header">
          <text class="qr-title">æˆ‘çš„äºŒç»´ç </text>
          <text class="qr-desc">å‘è€ƒåŠ¡äººå‘˜å‡ºç¤ºæ­¤ç è¿›è¡Œç­¾åˆ°</text>
        </view>
        <button class="qr-btn" bindtap="showMyQRCode">æ˜¾ç¤ºäºŒç»´ç </button>
      </view>

      <!-- æ’é˜ŸçŠ¶æ€ -->
      <view class="queue-card" wx:if="{{queuePosition}}">
        <view class="queue-header">
          <text class="queue-title">æ’é˜ŸçŠ¶æ€</text>
        </view>
        <view class="queue-info">
          <text class="venue-name">{{queuePosition.venue_name}}</text>
          <text class="position">ç¬¬ {{queuePosition.position}} ä½</text>
          <text class="waiting">å…± {{queuePosition.total_waiting}} äººç­‰å¾…</text>
          <text class="estimate" wx:if="{{queuePosition.estimated_wait_time}}">
            é¢„è®¡ç­‰å¾… {{queuePosition.estimated_wait_time}} åˆ†é’Ÿ
          </text>
        </view>
      </view>

      <!-- æˆ‘çš„æ—¥ç¨‹ -->
      <view class="schedule-card" wx:if="{{schedules.length > 0}}">
        <view class="schedule-header">
          <text class="schedule-title">æˆ‘çš„æ—¥ç¨‹</text>
        </view>
        <view class="schedule-list">
          <block wx:for="{{schedules}}" wx:key="id">
            <view class="schedule-item" bindtap="onScheduleDetail" data-schedule="{{item}}">
              <view class="schedule-info">
                <text class="exam-name">{{item.exam_product_name}}</text>
                <text class="venue-info">{{item.venue_name}} Â· {{item.exam_type}}</text>
                <text class="time-info">{{item.start_time}}</text>
              </view>
              <view class="schedule-status">
                <text class="status-text status-{{item.status}}">
                  {{item.status === 'pending' ? 'å¾…è¿›è¡Œ' : item.status === 'in_progress' ? 'è¿›è¡Œä¸­' : 'å·²å®Œæˆ'}}
                </text>
              </view>
            </view>
          </block>
        </view>
      </view>
    </view>

    <!-- é€€å‡ºç™»å½• -->
    <view class="logout-section">
      <button class="logout-btn" bindtap="logout">é€€å‡ºç™»å½•</button>
    </view>
  </view>

  <!-- äºŒç»´ç å¼¹çª— -->
  <view class="qr-modal" wx:if="{{showQRCode}}">
    <view class="qr-modal-content">
      <view class="qr-modal-header">
        <text class="qr-modal-title">æˆ‘çš„ç­¾åˆ°ç </text>
        <button class="qr-close-btn" bindtap="closeQRCode">Ã—</button>
      </view>
      <view class="qr-code-container">
        <image class="qr-code-image" src="{{qrCodeData}}" mode="aspectFit"></image>
      </view>
      <text class="qr-modal-tip">è¯·å‘è€ƒåŠ¡äººå‘˜å‡ºç¤ºæ­¤äºŒç»´ç </text>
    </view>
  </view>
</view>
